<head>
    {% load static %}
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="{% static "polls/mystyle2.css" %}">

</head>
<h1>Travel at Queenstown</h1>
<p>The best hotel to stay is {{hotel}}</p>
<h2>You can go to:</h2>
{% for location in locations %}
    <li>{{ location }}</li>
{% endfor %}
<div id="map" class="overlay"></div>
<script>


var directionDisplay;
var directionsService;
var map;
function myMap() {
    var geocoder = new google.maps.Geocoder();
    var homeAddress = '{{hotel}}'
    var mapOptions;
    geocoder.geocode( { 'address': homeAddress}, function(results, status) {
        if (status = 'OK') {
            var mapOptions = {
            center: results[0].geometry.location,
            zoom: 6,
            mapTypeId: google.maps.MapTypeId.ROADMAP
            }
        }
        else {
            console.log('Geocode was not successful for the following reason: ' + status);
        }
    })


	map = new google.maps.Map(document.getElementById("map"), mapOptions);

	var myNames = [];

    var directionsService = new google.maps.DirectionsService();
    var goLocations = [];

    {% for location in locations %}
        goLocations.push("{{location}}")
    {% endfor %}
    for (i = 0; i< goLocations.length; i++) {
        geocoder.geocode( { 'address': goLocations[i]}, function(results, status) {
            if (status = 'OK' && results && results[0]) {
                console.log('get direction for ' + results[0].geometry.location);
                calculateAndDisplayRoute(directionsService, '{{hotel}}', results[0].geometry.location)
            }
            else {
                console.log('Geocode was not successful for the following reason: ' + status);
            }
         })

    }



}

var markerIndex = 1;
function renderDirections(response, start, end) {

    var directionsRenderer = new google.maps.DirectionsRenderer({suppressMarkers: true});
    directionsRenderer.setMap(map);
    directionsRenderer.setDirections(response);
     // add start and end markers
    var my_route = response.routes[0];
    //window.alert('leg length is ' + my_route.legs.length)
    var marker = new google.maps.Marker({
        position: my_route.legs[0].start_location,
        label: "home",
        map: map
    });
    var marker = new google.maps.Marker({
    position: my_route.legs[0].end_location,
    label: "" + markerIndex,
    map: map
    })
    markerIndex++;

}
function calculateAndDisplayRoute(directionsService, start, end) {

        directionsService.route({
          origin: start,
          destination: end,
          travelMode: 'DRIVING',
        }, function(response, status) {
          if (status === 'OK') {
            renderDirections(response, start, end)
          } else {
            console.log('Directions request failed due to ' + status);
          }
        });
      }

</script>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDQXG5qgd9OTre3GsTmbh4QR0nLmuo4B2k&callback=myMap"></script>
